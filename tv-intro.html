<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- âœ… SEO: Intro soll nicht indexiert werden -->
  <meta name="robots" content="noindex,follow" />
  <!-- âœ… Canonical auf die eigentliche Startseite -->
  <link rel="canonical" href="https://www.b3nn3t.com/" />

  <title>TV-Intro â€“ b3nn3t | Intro-Annimation &amp; Visuals</title>
  <meta name="description" content="Das offizielle Intro von b3nn3t â€“ Sound, AtmosphÃ¤re und visuelle IdentitÃ¤t. Ein kurzer Einblick in die Welt hinter dem Intro." />

  <!-- (Optional) Spekulations-Regeln: Startseite vorladen/prerendern -->
  <script type="speculationrules">
  {
    "prefetch": [{ "source": "document", "urls": ["index.html"] }],
    "prerender": [{ "source": "document", "urls": ["index.html?nointro=1"] }]
  }
  </script>

  <style>
    :root {
      --fade-ms: 1000ms; /* Dauer der Ein-/Ausblendung */
      --bg: #930010;
    }

    html,body {
      margin:0;
      height:100%;
      background:var(--bg);     /* âœ… Hintergrund wie gewÃ¼nscht */
      overflow:hidden;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    }

    /* Canvas bleibt vorhanden, wird aber nicht animiert */
    canvas#c{
      display:block;
      width:100vw;
      height:100vh;
      image-rendering:pixelated;
      image-rendering:crisp-edges;
      opacity:0; /* bleibt unsichtbar */
    }

    /* Skip-Button (Intro Ã¼berspringen) */
    .skip {
      position:fixed; top:14px; right:14px; z-index:10;
      background:#fff; color:#000; border:0; border-radius:999px;
      padding:.45rem .8rem; font-weight:700; cursor:pointer;
    }
    .skip:focus-visible { outline:2px solid #fff; outline-offset:2px; }

    /* âœ… Loader Overlay */
    .loaderWrap{
      position:fixed;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      opacity:0;
      transition: opacity var(--fade-ms) ease;
      z-index:5;
      pointer-events:none;
    }
    body.ready .loaderWrap{ opacity:1; }     /* Fade-In */
    body.fadeout .loaderWrap{ opacity:0; }   /* Fade-Out */

    .loader{
      width:min(520px, 78vw);
      padding:18px 18px 16px;
      box-sizing:border-box;
    }

    .barFrame{
      width:100%;
      height:14px;
      border:2px solid #fff;
      border-radius:999px;
      padding:2px;
      box-sizing:border-box;
    }

    .bar{
      height:100%;
      width:0%;
      background:#fff;
      border-radius:999px;
    }

    .hint{
      margin-top:10px;
      color:rgba(255,255,255,.85);
      font-size:14px;
      letter-spacing:.2px;
      text-align:center;
      user-select:none;
    }

    /* Barrierefreiheit: Nutzer mit reduzierter Bewegung -> sofort weiter */
    @media (prefers-reduced-motion: reduce) {
      body { animation:none !important; }
      .loaderWrap { transition:none; }
    }
  </style>

  <!-- No-JS-Fallback: sofort weiterleiten -->
  <noscript>
    <meta http-equiv="refresh" content="0; url=index.html?nointro=1">
    <style>
      body { display:flex; align-items:center; justify-content:center; color:#fff; }
      a { color:#fff; text-decoration:underline; }
    </style>
    <p>Weiter zur <a href="index.html?nointro=1">Startseite</a>â€¦</p>
  </noscript>
</head>
<body>

  <main role="main">
    <button class="skip" type="button" aria-label="Intro Ã¼berspringen">Skip</button>

    <canvas id="c" aria-hidden="true"></canvas>

    <!-- âœ… Progress -->
    <div class="loaderWrap" aria-hidden="true">
      <div class="loader">
        <div class="barFrame">
          <div class="bar" id="bar"></div>
        </div>
        <div class="hint">Loadingâ€¦</div>
      </div>
    </div>

    <div aria-live="polite" style="position:absolute;left:-9999px;top:auto;width:1px;height:1px;overflow:hidden;">
      Intro lÃ¤uft. Du kannst â€žSkipâ€œ drÃ¼cken, um direkt zur Startseite zu wechseln.
    </div>
  </main>

<script>
/* ================== EINSTELLUNGEN ================== */
const USE_HEAD_IMAGE   = true;
const HEAD_IMG_URL     = "assets/tv-intro/dein-pixel.webp?v=1"; // bleibt drin

// Kopf-Keying (bleibt drin)
const KEY_TOLERANCE    = 65;
const KEY_SOFTNESS     = 0.45;
const KEY_CUTOFF       = 0.10;
const KEY_DESPECKLE    = 1;

// (Rest bleibt drin â€“ wird nur nicht mehr animiert)
const RUN_TO_RIGHT     = true;
const WORD             = "b3nn3t";
const HAMMER_MS        = 680;
const SPARK_COUNT      = 12;
const HEAD_SCALE       = 26;
const BODY_SCALE       = 16;
const LETTER_SIZE      = 24;
const LETTER_GAP       = 18;
const LETTER_TILT_MAX  = 6;
const LETTER_JITTER_Y  = 2;
const TILT_TRIGGER_PX  = 42;
const TILT_TARGET_DEG  = 24;
const TILT_MS          = 500;
const TILT_WOBBLE_MS   = 5800;
const TILT_PAUSE_MS    = 3000;
const GLOW_DELAY_MS    = 140;
const GLOW_MS          = 650;
const WAVE_DELAY_MS    = 800;
const WAVE_MS          = 1600;
const WAVE_STRENGTH    = 1.0;
const LINE_ERASE_MS    = 1200;

/* âœ… Redirect Ziel (wie vorher) */
const INTRO_RETURN_URL =
  (sessionStorage.getItem("introReturn") || "index.html") +
  (location.search.includes('nointro=1') ? "" : (location.search ? "&" : "?") + "nointro=1");

/* ================== PRELOAD bleibt drin ================== */
const preloadImages = [
  "assets/index/bennet_index1.avif",
  "assets/index/bennet_index1.webp",
  "assets/index/bennet_index2.avif",
  "assets/index/bennet_index2.webp",
  "assets/index/bennet_index3.avif",
  "assets/index/bennet_index3.webp",

  "assets/gesehen/insta1.webp",
  "assets/gesehen/insta2.webp",
  "assets/gesehen/insta3.webp",
  "assets/gesehen/insta4.webp",

  "assets/gesehen/reel1.avif",
  "assets/gesehen/reel2.avif",
  "assets/gesehen/reel3.avif",
  "assets/gesehen/reel4.avif",
  "assets/gesehen/reel5.avif",
  "assets/gesehen/reel6.avif",
  "assets/gesehen/reel7.avif",
  "assets/gesehen/instagram_poster.jpg",
  "https://img.youtube.com/vi/ZSaj_FuqPN8/hqdefault.jpg",
  "https://img.youtube.com/vi/DMNl40Tip1w/hqdefault.jpg",
  "https://img.youtube.com/vi/K5pKG0Smdfc/hqdefault.jpg",
  "https://img.youtube.com/vi/4I9vlcGvFGQ/hqdefault.jpg",
  "https://img.youtube.com/vi/w0pNdnlb96M/hqdefault.jpg",
  "https://img.youtube.com/vi/rV1U891RKLo/hqdefault.jpg",
  "https://img.youtube.com/vi/fq8zhAQMam0/hqdefault.jpg"
];
const preloadVideos = [ "assets/gesehen/B3NN3T.mp4" ];

function preloadAllImages(urls){
  urls.forEach(url=>{
    const img = new Image();
    img.referrerPolicy = "no-referrer";
    img.src = url;
  });
}
function preloadAllVideos(urls){
  urls.forEach(url=>{
    const v = document.createElement('video');
    v.preload = 'auto';
    v.muted = true;
    v.src = url;
    v.load();
  });
}

/* ðŸ”¥ Preload sofort beim Start (wie vorher) */
if(!window._preloaded){
  window._preloaded=true;
  preloadAllImages(preloadImages);
  preloadAllVideos(preloadVideos);
}

/* ================== (Canvas Setup bleibt drin, wird aber nicht benutzt) ================== */
const c = document.getElementById('c');
const ctx = c.getContext('2d');
let W=0,H=0,DPR=1;

function resize(){
  DPR=Math.max(1,Math.floor(window.devicePixelRatio||1));
  W=c.width=Math.floor(innerWidth*DPR);
  H=c.height=Math.floor(innerHeight*DPR);
  c.style.width=innerWidth+'px';
  c.style.height=innerHeight+'px';
  ctx.imageSmoothingEnabled=false;
}
addEventListener('resize',resize);resize();

/* Kopf laden & Keying bleibt drin (wird nur nicht gezeichnet) */
let headReady=false, headImg;
if(USE_HEAD_IMAGE){
  const raw=new Image();raw.crossOrigin="anonymous";
  raw.onload=()=>{
    headImg=removeBGSmart(raw,{
      tolerance:KEY_TOLERANCE,softness:KEY_SOFTNESS,cutoff:KEY_CUTOFF,despeckle:KEY_DESPECKLE
    });
    headReady=true;
  };
  raw.onerror=()=>{headReady=false;};
  raw.src=HEAD_IMG_URL;
}
function removeBGSmart(image,{tolerance=60,softness=.4,cutoff=.1,despeckle=1}={}){
  const w=image.naturalWidth||image.width,h=image.naturalHeight||image.height;
  const off=document.createElement('canvas');off.width=w;off.height=h;
  const octx=off.getContext('2d',{willReadFrequently:true});
  octx.imageSmoothingEnabled=false;octx.drawImage(image,0,0,w,h);
  const img=octx.getImageData(0,0,w,h),d=img.data;
  let sumR=0,sumG=0,sumB=0,count=0; const add=(ix)=>{sumR+=d[ix];sumG+=d[ix+1];sumB+=d[ix+2];count++;};
  for(let x=0;x<w;x++){add((x<<2));add((((h-1)*w+x)<<2));}
  for(let y=0;y<h;y++){add(((y*w)<<2));add(((y*w+(w-1))<<2));}
  const keyR=(sumR/count)|0,keyG=(sumG/count)|0,keyB=(sumB/count)|0;
  const rgb2ycbcr=(r,g,b)=>[0.299*r+0.587*g+0.114*b,-0.168736*r-0.331264*g+0.5*b+128,0.5*r-0.418688*g-0.081312*b+128];
  const [ky,kcb,kcr]=rgb2ycbcr(keyR,keyG,keyB);const tol=Math.max(1,tolerance);
  const smooth=(t)=>t<=0?0:t>=1?1:t*t*(3-2*t);
  for(let i=0;i<d.length;i+=4){
    const [y,cb,cr]=rgb2ycbcr(d[i],d[i+1],d[i+2]);
    const dist=Math.hypot(cb-kcb,cr-kcr)*0.9+Math.abs(y-ky)*0.1;
    let a=(dist-tol*cutoff)/Math.max(1,tol*(1-cutoff));
    a=smooth(a*(1+softness));a=Math.max(0,Math.min(1,a));
    d[i+3]=Math.round(255*a);
  }
  octx.putImageData(img,0,0);
  if(despeckle>0){
    const pass=octx.getImageData(0,0,w,h),p=pass.data,thr=140;
    const neigh=(x,y)=>{let n=0;for(let yy=-1;yy<=1;yy++)for(let xx=-1;xx<=1;xx++){if(!xx&&!yy)continue;const X=x+xx,Y=y+yy;if(X<0||Y<0||X>=w||Y>=h)continue;if(p[((Y*w+X)<<2)+3]>thr)n++;}return n;};
    for(let y=1;y<h-1;y++){for(let x=1;x<w-1;x++){const ai=((y*w+x)<<2)+3;if(p[ai]<=thr&&neigh(x,y)>=(despeckle===2?5:7))p[ai]=0;}}
    octx.putImageData(pass,0,0);
  }
  return off;
}

/* ================== Loader (neu) ================== */

/* Timing: wie vorherer Start: 1000ms warten, dann "ready".
   Danach: Ã¼ber INTRO_MS den Balken fÃ¼llen, dann fadeout + redirect.
   Setz INTRO_MS auf deine gewÃ¼nschte Intro-LÃ¤nge (ohne Start-Delay).
*/
const START_DELAY_MS = 1000;
const INTRO_MS = 7500;   // <- falls du die exakte Dauer willst: hier anpassen
const FADEOUT_MS = 1700;
const EXTRA_MS = 300;

let rafId=null;

function startTransition(){
  sessionStorage.setItem("introPlayed","1");
  document.body.classList.add('fadeout');
  setTimeout(()=>{ window.location.href = INTRO_RETURN_URL; }, FADEOUT_MS + EXTRA_MS);
}

function startProgress(){
  const bar = document.getElementById('bar');
  const start = performance.now();

  function frame(now){
    const t = (now - start) / INTRO_MS;
    const clamped = Math.max(0, Math.min(1, t));
    bar.style.width = (clamped * 100).toFixed(2) + "%";

    if(clamped >= 1){
      startTransition();
      return;
    }
    rafId = requestAnimationFrame(frame);
  }
  rafId = requestAnimationFrame(frame);
}

/* Skip-Button & Reduced-Motion (beibehalten) */
(function setupSkipAndA11y(){
  const skipBtn = document.querySelector('.skip');
  function goNow(){
    try { sessionStorage.setItem("introPlayed","1"); } catch(e){}
    document.body.classList.add('fadeout');
    setTimeout(()=>location.replace(INTRO_RETURN_URL), 250);
  }
  if (skipBtn) skipBtn.addEventListener('click', goNow);

  try {
    if (window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
      goNow();
      return;
    }
  } catch(e){}
})();

/* ===== Start (wie zuvor: 1000ms warten, dann einblenden) ===== */
setTimeout(() => {
  document.body.classList.add('ready'); // sanft einblenden
  startProgress();                      // âœ… Ladebalken starten
}, START_DELAY_MS);
</script>
</body>
</html>
